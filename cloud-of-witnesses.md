# ☁️ Cloud of Witnesses

A simple web app that allows users to upload files directly to an AWS S3 bucket using secure pre-signed URLs generated by an AWS Lambda function.

---

## 🚀 Architecture Overview

### 🖥️ Frontend

- Built with **Vanilla JavaScript**, **HTML**, and **CSS**
- Hosted on **GitHub Pages**

### ⚙️ Backend

- **AWS Lambda** (Node.js 18)
- Generates pre-signed S3 upload URLs
- Connected via **Lambda Function URL**

### 💾 Storage

- **Amazon S3 Bucket:** `cloud-of-witnesses-pilot`

---

## 🧱 How It Works

1. User selects a file in the browser.
2. The frontend sends a request to the **Lambda Function URL**.
3. Lambda generates a **pre-signed upload URL** for S3.
4. The browser uploads the file directly to **Amazon S3**.

---

## 🧩 AWS Setup Summary

- **S3 Bucket:** `cloud-of-witnesses-pilot`
- **Lambda Function:** Generates pre-signed S3 URLs
- **IAM Role:** Grants only `s3:PutObject` permission
- **Lambda Function URL:** Public endpoint for the web app

---

## 🪄 Lambda Function Code

```javascript
import { S3Client, PutObjectCommand } from "@aws-sdk/client-s3";
import { getSignedUrl } from "@aws-sdk/s3-request-presigner";

const s3Client = new S3Client({ region: "eu-west-1" });

export const handler = async (event) => {
  console.log("Lambda function started");
  console.log("Event:", JSON.stringify(event));

  try {
    // Get filename from request
    let filename = "test-file.txt";

    if (event.queryStringParameters && event.queryStringParameters.filename) {
      filename = event.queryStringParameters.filename;
    }

    if (event.body) {
      try {
        const body = JSON.parse(event.body);
        if (body.filename) {
          filename = body.filename;
        }
      } catch (parseError) {
        console.log("Body parsing failed, using query params or default");
      }
    }

    console.log("Using filename:", filename);

    // Generate presigned URL
    const command = new PutObjectCommand({
      Bucket: "cloud-of-witnesses-pilot",
      Key: filename,
      ContentType: "text/plain",
    });

    const uploadUrl = await getSignedUrl(s3Client, command, {
      expiresIn: 3600, // 1 hour
    });

    return {
      statusCode: 200,
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        uploadUrl: uploadUrl,
        filename: filename,
        bucket: "cloud-of-witnesses-pilot",
        message: `Presigned URL generated for file: ${filename}`,
      }),
    };
  } catch (error) {
    console.error("Lambda error:", error);

    return {
      statusCode: 500,
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        error: "Function failed",
        message: error.message,
        stack: error.stack,
      }),
    };
  }
};
```

🌍 **Hosting (GitHub Pages)**

Your app is hosted on:

`https://<your-username>.github.io/cloud-of-witnesses/`

To deploy:

1. Push your files to your GitHub repository.
2. Go to **Settings → Pages**.
3. Select **main branch → / (root) → Save**.
4. Visit your site using the provided GitHub Pages URL.

---

🔐 **Security Recommendations**

- Replace `"*"` in CORS settings with your GitHub Pages domain (e.g. `https://your-username.github.io`).
- Restrict IAM permissions strictly to `s3:PutObject` for the target bucket.
- Rotate AWS keys periodically.

---

🌟 **Future Enhancements**

- Add authentication (e.g. AWS Cognito or Firebase)
- Display upload progress and file list
- Support multiple file uploads
- Validate file size and type before upload

---

👨‍💻 **Author**

Delightsome Asolo  
📧 delightsomeasolo@gmail.com

🔗 **LinkedIn**

https://www.linkedin.com/in/delightsome-asolo/

---

🏷️ **License**

MIT License © 2025 Delightsome Asolo
